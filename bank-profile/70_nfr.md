# 70_nfr - 非功能需求

**建立日期**: 2025-11-19
**最後更新**: 2025-11-19
**文件版本**: 1.0.0
**關聯文件**:
- 業務目標: [10_business.md](10_business.md)
- 流程設計: [20_process.md](20_process.md)
- 風險控制: [30_risk_control.md](30_risk_control.md)
- 資安需求: [40_infosec.md](40_infosec.md)
- 法遵需求: [50_compliance.md](50_compliance.md)
- 稽核需求: [60_audit.md](60_audit.md)
**輸入**: 自動推導模式 (Based on Bank Profile)

---

## 文件目的

本文件定義「客戶洗錢風險事件摘要模型」專案的非功能需求 (Non-Functional Requirements, NFR)，涵蓋效能、可用性、可靠性、擴展性、安全性與合規性等技術指標，作為系統架構設計與驗收之依據。

---

## 1. 效能需求 (Performance)

### 1.1 回應時間 (Response Time)

| NFR ID | 需求描述 | 目標值 | 優先級 | 來源 |
|--------|----------|--------|--------|------|
| **NFR-PERF-001** | **單筆摘要生成時間** | < 5 秒 (P95) | P0 | 業務目標 (提升效率) |
| **NFR-PERF-002** | **案件詳情載入時間** | < 2 秒 (P95) | P1 | 使用者體驗 |
| **NFR-PERF-003** | **客戶搜尋回應時間** | < 1 秒 (P95) | P1 | 使用者體驗 |
| **NFR-PERF-004** | **稽核日誌查詢時間** | < 5 秒 (單一案件) | P2 | 稽核需求 |

### 1.2 吞吐量 (Throughput)

| NFR ID | 需求描述 | 目標值 | 優先級 | 來源 |
|--------|----------|--------|--------|------|
| **NFR-CAP-001** | **每日案件處理量** | 支援至少 1,000 筆/日 | P0 | 業務量預估 |
| **NFR-CAP-002** | **並發使用者數** | 支援至少 50 人同時在線 | P1 | 團隊規模 |
| **NFR-CAP-003** | **並發模型請求** | 支援至少 10 TPS | P1 | 尖峰負載預估 |

---

## 2. 可用性與可靠性 (Availability & Reliability)

### 2.1 服務水準目標 (SLA)

| NFR ID | 需求描述 | 目標值 | 優先級 | 備註 |
|--------|----------|--------|--------|------|
| **NFR-AVAIL-001** | **系統可用性** | **99.5%** (工作時段) | P0 | 允許每月約 4 小時停機 (維護) |
| **NFR-AVAIL-002** | **模型服務可用性** | 99.0% | P1 | 若模型失效，系統需支援降級模式 |
| **NFR-AVAIL-003** | **降級模式 (Fallback)** | 100% 可用 | P0 | 當 AI 失效時，必須允許人工完全接手 |

### 2.2 災難復原 (Disaster Recovery)

| NFR ID | 需求描述 | 目標值 | 優先級 | 來源 |
|--------|----------|--------|--------|------|
| **NFR-DR-001** | **復原時間目標 (RTO)** | **4 小時** | P0 | 業務中斷風險 |
| **NFR-DR-002** | **資料復原點目標 (RPO)** | **0** (資料不可遺失) | P0 | 法規要求 (已確認摘要不可遺失) |
| **NFR-DR-003** | **備份頻率** | 每日全備份 + 即時交易日誌 | P0 | 確保 RPO = 0 |

---

## 3. 安全性與合規性 (Security & Compliance)

*整合自 `40_infosec.md` 與 `50_compliance.md`*

| NFR ID | 需求描述 | 規格/指標 | 優先級 | 來源 |
|--------|----------|-----------|--------|------|
| **NFR-SEC-001** | **傳輸加密** | TLS 1.2 或 1.3 | P0 | 資安規範 |
| **NFR-SEC-002** | **靜態加密** | AES-256 (資料庫與備份) | P0 | 資安規範 |
| **NFR-SEC-003** | **密碼強度** | 至少 12 碼，含英數符號 | P0 | 資安規範 |
| **NFR-COMP-001** | **個資遮罩** | 依角色動態遮罩 PII | P0 | 個資法 |
| **NFR-COMP-002** | **日誌保留** | 線上 1 年 + 封存 6 年 (共 7 年) | P0 | 洗錢防制法 |

---

## 4. 維運與監控 (Operations & Monitoring)

### 4.1 監控指標

| NFR ID | 監控項目 | 告警門檻 | 優先級 | 對應 KRI |
|--------|----------|----------|--------|----------|
| **NFR-MON-001** | **模型錯誤率** | > 5% (每小時) | P1 | KRI-001 |
| **NFR-MON-002** | **系統回應時間** | P95 > 5 秒 | P2 | - |
| **NFR-MON-003** | **異常存取偵測** | 非上班時間存取 > 0 | P1 | KRI-004 |
| **NFR-MON-004** | **磁碟空間使用率** | > 80% | P1 | - |

### 4.2 健康檢查

- **NFR-OPS-001**: 系統需提供 `/health` API，回傳資料庫、模型服務、儲存服務之連線狀態。
- **NFR-OPS-002**: 系統日誌需整合至集中式日誌平台 (如 ELK/Splunk)，並包含 `Trace ID` 以利除錯。

---

## 5. 擴展性 (Scalability)

| NFR ID | 需求描述 | 目標值 | 優先級 |
|--------|----------|--------|--------|
| **NFR-SCALE-001** | **資料量成長** | 支援每年 20% 資料量成長 (3 年規劃) | P2 |
| **NFR-SCALE-002** | **水平擴展** | 應用層需無狀態 (Stateless)，支援水平擴展 | P1 |
| **NFR-SCALE-003** | **資料庫擴展** | 資料庫需支援讀寫分離或分片 (Sharding) 預留 | P2 |

---

## 6. 模型治理 (Model Governance)

*AI/ML 專案特定需求*

| NFR ID | 需求描述 | 規格 | 優先級 |
|--------|----------|------|--------|
| **NFR-MODEL-001** | **版本控制** | 模型檔案與參數需納入版控 (DVC/Git) | P0 |
| **NFR-MODEL-002** | **可重現性** | 需能依據版本編號重現特定模型之推論結果 | P0 |
| **NFR-MODEL-003** | **模型部署** | 支援藍綠部署 (Blue-Green) 或金絲雀發布 | P2 |
| **NFR-MODEL-004** | **回退機制** | 模型更新失敗需能在 10 分鐘內回退至前一版 | P1 |

---

## 7. 測試策略建議

針對上述 NFR，建議執行以下測試：

1. **效能測試 (Performance Testing)**: 使用 JMeter 或 k6 模擬 50 人並發，驗證回應時間與吞吐量。
2. **災難復原演練 (DR Drill)**: 每年執行一次資料庫還原演練，驗證 RTO/RPO。
3. **安全性掃描 (Security Scan)**: 上線前執行源碼檢測 (SAST) 與弱點掃描 (DAST)。
4. **長跑測試 (Soak Testing)**: 持續運行系統 48 小時，觀察是否有記憶體洩漏 (Memory Leak)。

---

## 8. 下一步建議

1. **架構設計**: 依據 NFR (特別是 RPO=0 與水平擴展需求) 進行系統架構設計 (`/speckit.plan`)。
2. **基礎建設**: 規劃雲端或地端資源規格 (CPU/RAM/Storage) 以滿足效能與容量需求。
3. **SLA 簽署**: 與業務部門正式簽署 SLA，確認可用性目標與維護時段。
