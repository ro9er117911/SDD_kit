---
description: 從使用者描述產生業務目標與使用者情境文件（10_business.md），包含 KPI、使用者故事（Gherkin 格式）、業務規則等。
---

## 使用者輸入

```text
$ARGUMENTS
```

觸發 `/speckit.business` 時使用者在命令後所輸入的文本即為功能/系統的業務描述。

## 流程總覽

此命令用於定義**業務層面的需求與使用者場景**，是 Bank Profile 需求對齊層的核心文件之一。應在 `/speckit.specify` 之前或平行執行，為技術規格提供業務上下文。

## 目標定位

**10_business.md 關注**：
- WHY：為什麼要做（業務目標、痛點、機會）
- WHO：誰使用（角色定義、使用頻率、技能水平）
- WHAT：要做什麼（使用者故事、驗收情境）
- VALUE：帶來什麼價值（KPI、成功標準）

**NOT in scope**：
- HOW：如何實作（屬於 plan.md）
- WHEN：實作順序（屬於 tasks.md）
- WHERE：系統架構（屬於 plan.md）

## 執行步驟

### 1. 初始設定與路徑確認

1. **檢查專案環境**：
   - 執行 `git rev-parse --show-toplevel` 取得 repo root
   - 確認是否已有 `project/meta/00_meta.md`（若有則載入作為上下文）
   - 設定 BUSINESS_DIR = `$REPO_ROOT/project/business`

2. **檢查既有文件**：
   - 若 `$BUSINESS_DIR/10_business.md` 已存在，詢問：
     - 「發現既有 10_business.md，是否要更新？(yes/no/merge)」
     - `yes`: 完全覆寫
     - `no`: 中止執行
     - `merge`: 保留既有使用者故事，新增新的故事
   - 若不存在，則建立新檔案

### 2. 資訊收集階段（智能問答）

**目標**：透過最多 **8 個精準問題**，收集業務目標、使用者角色、KPI 等關鍵資訊。

**問答策略**：
- 從 `$ARGUMENTS` 和 `00_meta.md`（若存在）中擷取已知資訊
- 僅詢問未明確提及且會影響使用者故事設計的資訊
- 每題提供推薦答案或選項，支援 `yes`/`skip` 快速確認

#### 問題分類

**第 1 層：業務目標與痛點 (P0 - 必問)**

1. **Q1: 核心業務目標確認**
   ```
   此功能/系統的主要業務目標是什麼？

   **從輸入推導的目標**:
   [從 $ARGUMENTS 擷取的目標]

   請確認或補充（回答 'yes' 接受推薦，或提供補充說明）

   格式建議：
   - 動詞開頭（提升/降低/自動化/整合/優化）
   - 具體對象（什麼流程/資料/系統）
   - 預期結果（達成什麼效果）
   ```

2. **Q2: 當前痛點識別**
   ```
   當前最主要的 3 個痛點是什麼？

   **推薦痛點**（從 $ARGUMENTS 推導）:
   - [痛點 1]: [描述]
   - [痛點 2]: [描述]
   - [痛點 3]: [描述]

   請確認或修改（回答 'yes' 接受，或逐行提供實際痛點）

   提示：好的痛點描述包含：
   - 誰受影響
   - 什麼問題
   - 造成什麼後果（時間/成本/風險）
   ```

**第 2 層：使用者與場景 (P1 - 高優先)**

3. **Q3: 主要使用者角色**
   ```
   誰會使用此系統/功能？請列出主要使用者角色（2-5 個）

   **推薦角色**（從 $ARGUMENTS 和 00_meta 推導）:
   - [角色 1]: [簡述職責]
   - [角色 2]: [簡述職責]

   請確認或補充（回答 'yes' 接受，或提供實際角色列表）

   格式：角色名稱 - 職責簡述
   範例：洗錢防制分析人員 - 每日處理 STR 個案並撰寫摘要
   ```

4. **Q4: 核心使用場景識別**
   ```
   使用者最常執行的 3 個核心場景是什麼？

   範例場景：
   - 分析人員審閱 AI 建議摘要並修改
   - 法遵主管檢視摘要品質報表
   - 稽核人員查詢歷史個案摘要

   請描述 3 個核心場景（或回答 'later' 稍後補充）
   ```

**第 3 層：成功標準 (P1 - 高優先)**

5. **Q5: 可量化的 KPI**
   ```
   如何衡量此專案成功？請提供 2-3 個可量化的 KPI

   提示：好的 KPI 包含：
   - 具體指標（時間/成本/錯誤率/滿意度）
   - 基準值（當前數字）
   - 目標值（期望改善幅度）

   **推薦 KPI 類型**（根據業務目標推導）:
   | 類型 | 範例 KPI |
   |------|----------|
   | 效率提升 | 作業時間減少 X% |
   | 品質改善 | 錯誤率降低至 X% |
   | 成本節省 | 人力成本節省 X 萬元/年 |
   | 風險降低 | 合規違規事件減少 X 件 |

   請提供 2-3 個 KPI（或回答 'skip' 稍後補充）
   ```

**第 4 層：優先級與範圍 (P2 - 中優先)**

6. **Q6: 使用者故事優先級分配**
   ```
   在您描述的場景中，哪些是 MVP 必須包含的？

   **推薦優先級分配**:
   - P1 (MVP 必備): [場景 A, 場景 B]
   - P2 (重要但可延後): [場景 C]
   - P3 (優化功能): [場景 D]

   請確認或調整（回答 'yes' 接受推薦，或說明您的優先級判斷）
   ```

7. **Q7: 邊界與例外情況**
   ```
   請描述 2-3 個需要特別處理的邊界或例外情況

   範例：
   - 當 AI 模型無法產生有效摘要時如何處理
   - 當使用者權限不足時如何提示
   - 當上游資料來源異常時如何回應

   請提供邊界/例外情況（或回答 'skip'）
   ```

**第 5 層：業務規則 (P3 - 可選)**

8. **Q8: 必須遵守的業務規則**
   ```
   是否有必須遵守的業務邏輯或限制？

   範例：
   - 每筆記錄必須包含特定欄位
   - 資料保留期限要求
   - 審核/核准流程要求
   - 權限分級要求

   請列出關鍵業務規則（或回答 'skip'，將從上下文推導）
   ```

#### 問答規則

- **最多 8 題**，若 `$ARGUMENTS` 已提供足夠資訊可少於 8 題
- 每題必須提供**推薦答案或範例**
- 使用者可回答：
  - 具體答案（逐行輸入或結構化輸入）
  - `yes` / `ok` / `recommended`（接受推薦）
  - `skip` / `later`（跳過，稍後手動填寫）
  - `stop` / `done`（終止問答，直接生成）
- 若 `skip` 超過一半問題，提示：「建議至少回答業務目標、使用者角色、核心場景這三類問題」

### 3. 使用者故事生成

根據收集的資訊，自動生成使用者故事骨架：

**生成規則**：

1. **從核心場景產生故事**：
   - 每個核心場景 → 1 個使用者故事
   - 自動套用 Gherkin 格式骨架

2. **自動分配優先級**：
   - 直接解決主要痛點的場景 → P1
   - 支援監控/報表/審核的場景 → P2
   - 優化/便利性功能 → P3

3. **生成驗收情境骨架**：
   - 每個故事至少 2 個 Gherkin 情境（1 正常流程 + 1 例外）
   - 格式：`假設 [Given] → 當 [When] → 則 [Then]`

4. **故事獨立性檢查**：
   - 確保每個故事可單獨交付價值
   - 若故事間有強依賴，標註「前置需求」

**生成範例**：

從場景「分析人員審閱 AI 建議摘要」生成：

```markdown
### 使用者故事 1 - 分析人員審閱模型建議摘要（優先級：P1）🎯 MVP

**角色**: 洗錢防制分析人員

**業務價值**: 減少撰寫摘要時間，讓分析人員專注於風險判斷而非格式化文字

**故事描述**:
作為 洗錢防制分析人員，我想要 查看 AI 自動產生的 STR 摘要建議，以便 快速審閱並確認關鍵風險指標是否完整。

**為何是此優先級**: 直接對應最主要使用者與時間節省來源，是本專案核心價值。

**獨立測試**: 只實作此故事即可完成「模型產生摘要 → 人工審核 → 儲存」閉環。

**驗收情境（Gherkin）**:

**情境 1.1**: 查看 AI 產生的摘要
\```gherkin
假設 系統中已有一筆新產生的 STR 個案，且已由模型生成摘要
當 分析人員開啟該個案檢視畫面
則 系統顯示：
  - 模型產生的摘要文字
  - 抽取的關鍵欄位（交易金額、次數、期間、可疑行為類型等）
  並且 摘要文字可編輯
\```
```

### 4. 內容補充與推導

根據使用者回答，自動補充以下內容：

**自動推導規則**：

1. **KPI 基準值與目標值**：
   - 若使用者僅提供目標，推導基準值（例如「減少 40%」→ 推導需要詢問當前耗時）
   - 標註 `[需實際測量]` 提醒補充

2. **使用者角色詳細資訊**：
   - 從 00_meta.md 的利害關係人推導角色
   - 自動填入「職責」、「使用頻率」（推測）
   - 標註 `[待確認]` 的推測項目

3. **業務規則識別**：
   - 從痛點和場景中識別隱含的業務規則
   - 範例：「摘要需包含關鍵資訊」→ 推導出必填欄位規則

4. **邊界情況補充**：
   - 從例外情境推導常見邊界情況
   - 範例：「當資料異常」→ 補充「資料格式錯誤」、「資料缺失」、「資料超出預期範圍」

5. **非功能性業務需求**：
   - 從使用頻率推導效能需求
   - 從業務性質推導可靠性需求
   - 範例：「每日處理 100+ 個案」→ 推導「尖峰時段為每日 14:00-16:00」

### 5. 品質檢查

生成 10_business.md 前執行以下檢查：

**完整性檢查**：
- [ ] 至少有 1 個明確的業務目標
- [ ] 至少有 2 個可量化的 KPI
- [ ] 至少定義 2 個使用者角色
- [ ] 至少有 2 個使用者故事（P1 優先級）
- [ ] 每個故事至少有 1 個 Gherkin 驗收情境

**清晰度檢查**：
- [ ] 業務目標具體可理解（非空泛）
- [ ] KPI 包含基準值和目標值（或標註待測量）
- [ ] 使用者故事符合「作為...我想要...以便...」格式
- [ ] Gherkin 情境使用「假設-當-則」結構

**一致性檢查**：
- [ ] 使用者故事的角色在「使用者角色定義」中有定義
- [ ] KPI 與業務目標對齊
- [ ] 優先級分配合理（P1 故事解決主要痛點）

**獨立性檢查**：
- [ ] 每個 P1 故事可獨立交付價值
- [ ] 故事間的依賴已標註

若檢查未通過，回報未通過項目並詢問：「是否要補充資訊或調整？(yes/no/continue)」

### 6. 生成 10_business.md

1. **載入模板**：
   - 讀取 `.specify/templates/10_business-template.md`

2. **填寫內容**：
   - 替換所有 `[PLACEHOLDER]`
   - 對於未收集到的資訊：
     - 必填欄位：標註 `[TBD - 待補充]`
     - 可推導欄位：自動推導並標註 `[推導]`
     - 選填欄位：保留範例或標註 `[選填]`
   - 填寫當前日期到 `[DATE]`

3. **Gherkin 格式化**：
   - 確保所有驗收情境使用正確的 Gherkin 語法
   - 格式：
     ```gherkin
     假設 [前置條件]
     當 [動作]
     則 [結果]
       並且 [額外驗證]
     ```



### 7. 寫入檔案

1. **建立目錄**：
   ```bash
   mkdir -p $REPO_ROOT/project/business
   ```

2. **寫入文件**：
   - 路徑：`$REPO_ROOT/project/business/10_business.md`
   - 若為 `merge` 模式：保留既有故事，append 新故事並重新編號

3. **產生記錄**：
   - 在文件末尾附加 session 記錄：
     ```markdown
     ### Session YYYY-MM-DD HH:MM
     - 命令：`/speckit.business`
     - 輸入：「$ARGUMENTS」
     - 問答輪數：[N] 題
     - 使用者故事數：[N] 個
     - 覆蓋角色：[角色列表]
     ```

### 8. 與 spec.md 的整合建議

完成後提示使用者：

```
💡 10_business.md 已生成，下一步建議：

選項 A：直接從 10_business.md 生成技術規格
  → 執行 `/speckit.specify --from-business`
  → 系統將從 10_business.md 的使用者故事自動產生 spec.md

選項 B：先補充流程文件再生成規格
  → 執行 `/speckit.process` 補充 As-Is / To-Be 流程
  → 執行 `/speckit.specify --from-business-and-process`

選項 C：手動檢視並補充 10_business.md
  → 開啟 project/business/10_business.md 檢視
  → 補充 [TBD] 標註的欄位
  → 執行 `/speckit.specify --from-business`
```

### 9. 輸出訊息

**成功輸出**：
```
✅ 業務目標與使用者情境文件已生成

📄 檔案路徑: $REPO_ROOT/project/business/10_business.md

📊 內容摘要:
  ✓ 業務目標: [N] 個
  ✓ KPI: [N] 個（[X] 個已量化，[Y] 個待測量）
  ✓ 使用者角色: [N] 個
  ✓ 使用者故事: [N] 個
    - P1 (MVP): [N] 個 🎯
    - P2 (重要): [N] 個
    - P3 (優化): [N] 個
  ✓ Gherkin 驗收情境: [N] 個

⚠️ 待補充項目 ([N] 項):
  - KPI 基準值需實際測量 ([N] 個)
  - 使用者角色使用頻率待確認 ([N] 個)
  - 邊界情況需進一步定義 ([N] 個)

💡 下一步建議:
  1. 檢視並補充 [TBD] 標註的欄位
  2. 與業務單位確認使用者故事優先級
  3. 執行 `/speckit.process` 補充流程文件
  4. 或直接執行 `/speckit.specify --from-business` 產生技術規格
```

**錯誤處理**：
- 若 `$ARGUMENTS` 為空且使用者拒絕回答任何問題 → ERROR: 「無法生成文件，至少需要業務目標或核心場景描述」
- 若必填項目（業務目標、使用者角色、核心場景）無法推導 → ERROR: 「缺少關鍵資訊，請提供業務目標和主要使用者角色」

## 與其他命令的整合

### 與 /speckit.meta 的關係

- **執行順序**：建議 `00_meta → 10_business → 20_process → spec`
- **資訊流向**：
  - 從 00_meta.md 讀取利害關係人 → 推導使用者角色
  - 從 00_meta.md 讀取專案目標 → 對齊業務目標
  - 從 00_meta.md 讀取時程 → 推導 MVP 範圍

### 與 /speckit.specify 的關係

- **10_business.md 為業務層需求**（WHO, WHY, WHAT-VALUE）
- **spec.md 為技術層規格**（WHAT-FEATURE, HOW-VERIFY）
- 使用者故事 (10_business) → 功能需求 (spec)
- Gherkin 驗收情境 (10_business) → 測試場景 (spec)

### 與 /speckit.process 的關係

- **10_business 定義「做什麼」**（使用者目標）
- **20_process 定義「怎麼流動」**（業務流程）
- 兩者互補，共同構成完整的業務需求

## 特殊模式

### 快速模式 (--quick)

若使用者傳入 `--quick`：
- 僅問 3 個關鍵問題（Q1, Q3, Q4）
- 自動推導 KPI、優先級、邊界情況
- 完整度可能 60-70%

### 從 meta 繼承模式 (--from-meta)

若已有完善的 00_meta.md：
- 自動從 meta 讀取業務背景、利害關係人、成功標準
- 僅詢問 meta 未涵蓋的使用者場景細節
- 減少問答輪數至 3-5 題

### 更新模式 (--update)

若 10_business.md 已存在：
- 載入既有內容
- 詢問：「要新增故事、修改 KPI、還是調整優先級？」
- 僅更新指定部分

## 品質標準

產出的 10_business.md 必須符合：
- **業務導向**: 所有描述從業務視角出發，無技術術語
- **可測試性**: 每個使用者故事有明確的驗收情境
- **可量化性**: KPI 具體可衡量
- **獨立性**: P1 故事可獨立交付價值
- **可追溯性**: 記錄產生來源與問答過程

## 案例情境：STR/SAR 摘要模型

若使用者輸入：
```
/speckit.business 建立客戶洗錢風險事件摘要模型，自動從 STR/SAR 文本抽取關鍵資訊並產生摘要
```

系統將：
1. 推導業務目標：「降低分析人員撰寫摘要時間」、「提升摘要一致性」
2. 推導主要角色：「洗錢防制分析人員」、「法遵主管」、「稽核人員」
3. 推導核心場景：「審閱 AI 建議摘要」、「檢視摘要品質」、「查詢歷史摘要」
4. 生成 P1 故事：「分析人員審閱模型建議摘要」
5. 生成 Gherkin 情境：「假設系統已產生摘要 → 當分析人員開啟 → 則顯示摘要與關鍵欄位」

## 注意事項

1. **聚焦業務價值**：所有內容必須從業務角度描述，避免技術實作細節
2. **使用者故事獨立性**：確保每個 P1 故事可單獨交付並驗證
3. **Gherkin 格式嚴格**：必須使用「假設-當-則」三段式，避免模糊描述
4. **避免過度設計**：僅收集必要資訊，不詢問實作細節
5. **與 constitution 對齊**：生成的故事應符合 TDD 原則（可測試、可驗證）
