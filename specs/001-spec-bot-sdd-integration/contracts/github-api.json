{
  "openapi": "3.0.0",
  "info": {
    "title": "GitHub API Contracts for Spec Bot",
    "description": "Spec Bot 與 GitHub API 的互動契約定義",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://api.github.com",
      "description": "GitHub REST API v3"
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "token",
        "description": "GitHub Fine-grained Personal Access Token"
      }
    },
    "schemas": {
      "CreateBranchRequest": {
        "type": "object",
        "required": ["ref", "sha"],
        "properties": {
          "ref": {
            "type": "string",
            "pattern": "^refs/heads/bot/spec-\\d{8}-\\d{6}$",
            "example": "refs/heads/bot/spec-20251113-143022",
            "description": "新分支的完整 ref（包含 refs/heads/ 前綴）"
          },
          "sha": {
            "type": "string",
            "pattern": "^[0-9a-f]{40}$",
            "example": "abc1234567890def1234567890abcdef12345678",
            "description": "新分支的起點 commit SHA（通常為 main 的最新 commit）"
          }
        }
      },
      "CreateBranchResponse": {
        "type": "object",
        "properties": {
          "ref": {
            "type": "string",
            "example": "refs/heads/bot/spec-20251113-143022"
          },
          "node_id": {
            "type": "string"
          },
          "url": {
            "type": "string",
            "format": "uri"
          },
          "object": {
            "type": "object",
            "properties": {
              "sha": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": ["commit", "tag"]
              },
              "url": {
                "type": "string",
                "format": "uri"
              }
            }
          }
        }
      },
      "CreateFileCommitRequest": {
        "type": "object",
        "required": ["message", "content", "branch"],
        "properties": {
          "message": {
            "type": "string",
            "example": "feat: 新增 Spec Bot SDD 整合 SDD",
            "description": "Commit 訊息"
          },
          "content": {
            "type": "string",
            "format": "base64",
            "description": "檔案內容（Base64 編碼）"
          },
          "branch": {
            "type": "string",
            "example": "bot/spec-20251113-143022",
            "description": "目標分支名稱"
          },
          "author": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "example": "Spec Bot"
              },
              "email": {
                "type": "string",
                "format": "email",
                "example": "spec-bot@company.com"
              }
            }
          },
          "committer": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "email": {
                "type": "string",
                "format": "email"
              }
            }
          }
        }
      },
      "CreateFileCommitResponse": {
        "type": "object",
        "properties": {
          "content": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "path": {
                "type": "string"
              },
              "sha": {
                "type": "string",
                "pattern": "^[0-9a-f]{40}$"
              },
              "size": {
                "type": "integer"
              },
              "type": {
                "type": "string",
                "enum": ["file", "dir", "submodule", "symlink"]
              },
              "url": {
                "type": "string",
                "format": "uri"
              },
              "html_url": {
                "type": "string",
                "format": "uri"
              },
              "download_url": {
                "type": "string",
                "format": "uri"
              }
            }
          },
          "commit": {
            "type": "object",
            "properties": {
              "sha": {
                "type": "string",
                "pattern": "^[0-9a-f]{40}$"
              },
              "url": {
                "type": "string",
                "format": "uri"
              },
              "html_url": {
                "type": "string",
                "format": "uri"
              },
              "author": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "date": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              },
              "message": {
                "type": "string"
              }
            }
          }
        }
      },
      "CreatePullRequestRequest": {
        "type": "object",
        "required": ["title", "head", "base"],
        "properties": {
          "title": {
            "type": "string",
            "example": "feat: 新增 Spec Bot SDD 整合 SDD",
            "description": "PR 標題"
          },
          "head": {
            "type": "string",
            "example": "bot/spec-20251113-143022",
            "description": "功能分支名稱"
          },
          "base": {
            "type": "string",
            "example": "main",
            "description": "目標分支（通常為 main）"
          },
          "body": {
            "type": "string",
            "description": "PR 描述（Markdown 格式）"
          },
          "draft": {
            "type": "boolean",
            "default": false,
            "description": "是否為草稿 PR"
          }
        }
      },
      "CreatePullRequestResponse": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "format": "uri"
          },
          "id": {
            "type": "integer"
          },
          "node_id": {
            "type": "string"
          },
          "number": {
            "type": "integer",
            "example": 42,
            "description": "PR 編號"
          },
          "title": {
            "type": "string"
          },
          "user": {
            "type": "object"
          },
          "body": {
            "type": "string"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "closed_at": {
            "type": ["string", "null"],
            "format": "date-time"
          },
          "merged_at": {
            "type": ["string", "null"],
            "format": "date-time"
          },
          "merge_commit_sha": {
            "type": ["string", "null"],
            "pattern": "^[0-9a-f]{40}$"
          },
          "assignee": {
            "type": ["object", "null"]
          },
          "assignees": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "requested_reviewers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "login": {
                  "type": "string"
                },
                "id": {
                  "type": "integer"
                }
              }
            }
          },
          "state": {
            "type": "string",
            "enum": ["open", "closed"]
          },
          "locked": {
            "type": "boolean"
          },
          "draft": {
            "type": "boolean"
          },
          "statuses_url": {
            "type": "string",
            "format": "uri"
          },
          "html_url": {
            "type": "string",
            "format": "uri",
            "example": "https://github.com/owner/repo/pull/42"
          }
        }
      },
      "UpdatePullRequestReviewersRequest": {
        "type": "object",
        "properties": {
          "reviewers": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": ["team-sa", "team-architect"],
            "description": "審核者 GitHub 使用者名稱清單"
          },
          "team_reviewers": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": ["team-sa", "team-architect"],
            "description": "審核團隊清單"
          }
        }
      },
      "CreateReleaseRequest": {
        "type": "object",
        "required": ["tag_name", "name"],
        "properties": {
          "tag_name": {
            "type": "string",
            "pattern": "^sdd-v\\d{8}-\\d{6}$",
            "example": "sdd-v20251113-143035",
            "description": "Git tag 名稱"
          },
          "name": {
            "type": "string",
            "example": "SDD Release - Spec Bot SDD 整合 - 2025-11-13",
            "description": "Release 標題"
          },
          "body": {
            "type": "string",
            "description": "Release notes（Markdown 格式）"
          },
          "draft": {
            "type": "boolean",
            "default": false,
            "description": "是否為草稿 release"
          },
          "prerelease": {
            "type": "boolean",
            "default": false,
            "description": "是否為預發行版本"
          }
        }
      },
      "CreateReleaseResponse": {
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "format": "uri"
          },
          "id": {
            "type": "integer"
          },
          "tag_name": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "draft": {
            "type": "boolean"
          },
          "prerelease": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "published_at": {
            "type": "string",
            "format": "date-time"
          },
          "assets": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "url": {
                  "type": "string",
                  "format": "uri"
                },
                "id": {
                  "type": "integer"
                },
                "name": {
                  "type": "string"
                },
                "size": {
                  "type": "integer"
                },
                "download_count": {
                  "type": "integer"
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time"
                },
                "updated_at": {
                  "type": "string",
                  "format": "date-time"
                },
                "browser_download_url": {
                  "type": "string",
                  "format": "uri"
                }
              }
            }
          },
          "html_url": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "Error": {
        "type": "object",
        "required": ["message"],
        "properties": {
          "message": {
            "type": "string"
          },
          "documentation_url": {
            "type": "string",
            "format": "uri"
          },
          "status": {
            "type": "string"
          }
        }
      }
    }
  },
  "paths": {
    "/repos/{owner}/{repo}/git/refs": {
      "post": {
        "summary": "建立新分支",
        "operationId": "createBranch",
        "tags": ["Branches"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "owner",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "repo",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBranchRequest"
              },
              "example": {
                "ref": "refs/heads/bot/spec-20251113-143022",
                "sha": "abc1234567890def1234567890abcdef12345678"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "分支建立成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateBranchResponse"
                }
              }
            }
          },
          "422": {
            "description": "驗證失敗（如分支已存在）",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/repos/{owner}/{repo}/contents/{path}": {
      "put": {
        "summary": "建立或更新檔案",
        "operationId": "createOrUpdateFile",
        "tags": ["Contents"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "owner",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "repo",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "path",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "example": "specs/001-spec-bot-sdd-integration/01_系統概述.md"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateFileCommitRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "檔案建立成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateFileCommitResponse"
                }
              }
            }
          },
          "200": {
            "description": "檔案更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateFileCommitResponse"
                }
              }
            }
          }
        }
      }
    },
    "/repos/{owner}/{repo}/pulls": {
      "post": {
        "summary": "建立 Pull Request",
        "operationId": "createPullRequest",
        "tags": ["Pull Requests"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "owner",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "repo",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreatePullRequestRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "PR 建立成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreatePullRequestResponse"
                }
              }
            }
          },
          "422": {
            "description": "驗證失敗",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/repos/{owner}/{repo}/pulls/{pull_number}/requested_reviewers": {
      "post": {
        "summary": "指派 PR 審核者",
        "operationId": "requestPullRequestReviewers",
        "tags": ["Pull Requests"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "owner",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "repo",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pull_number",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "example": 42
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdatePullRequestReviewersRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "審核者指派成功"
          },
          "422": {
            "description": "驗證失敗"
          }
        }
      }
    },
    "/repos/{owner}/{repo}/releases": {
      "post": {
        "summary": "建立 GitHub Release",
        "operationId": "createRelease",
        "tags": ["Releases"],
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "owner",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "repo",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateReleaseRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Release 建立成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CreateReleaseResponse"
                }
              }
            }
          },
          "422": {
            "description": "驗證失敗"
          }
        }
      }
    }
  }
}
