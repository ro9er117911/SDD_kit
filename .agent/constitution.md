# 專案憲法 (Constitution)

> **專案代號**: RISK-FINWARN
> **專案名稱**: 法人財報預警模型 MLOps 部署
> **建立日期**: 2025-11-21
> **版本**: 1.0.0

---

## 憲法總則

本憲法定義了 **RISK-FINWARN** 專案的**不可變約束**與**核心原則**。

所有功能開發、技術決策、系統變更必須遵守本憲法,不得違反。若需變更憲法,必須經過專案督導主管核准並重新發布。

**適用範圍**:
- 模型訓練與推論
- API 開發與整合
- 系統部署與維運
- 資料處理與存取
- 文件與流程

---

## 第一章：技術約束（不可變）

### 第 1 條：強制使用技術

**1.1 程式語言與框架**
- Python 3.12.x（訓練與推論）
- FastAPI 0.110.x+（API 框架）
- XGBoost 2.0.x+ / RandomForest（模型演算法）

**1.2 部署與基礎設施**
- Kubernetes 1.25+（容器編排,內網部署）
- GitLab CI/CD 15.0+（MLOps 流水線）
- Docker 24.x+（容器映像）

**1.3 資料庫與儲存**
- PostgreSQL 12+（結構化資料）或 SQL Server 2016+
- K8s PV（模型 artifact 與訓練資料）
- ELK/OpenSearch/Splunk（日誌儲存,7 年保留）

**1.4 安全加密**
- TLS 1.2+（傳輸加密,禁用 TLS 1.0/1.1）
- AES-256（靜態資料加密）
- K8s Secret（機密資訊管理,etcd 加密）

**違反處理**: 技術選型違反本條,必須重新設計並提交審查。

### 第 2 條：禁止使用技術

**2.1 弱安全加密**
- ❌ TLS 1.0 / TLS 1.1（已淘汰）
- ❌ RC4 / DES / 3DES / MD5（弱加密套件）

**2.2 授權風險套件**
- ❌ GPL 授權 Python 套件（授權污染風險）
- ✅ 優先使用 MIT / Apache 2.0 / BSD 授權

**2.3 外部服務（Q4 前）**
- ❌ 公有雲外部 API（如 Azure OpenAI、AWS Bedrock）
- 📋 Q4 GAI PoC 若需使用外部服務,必須完成委外評估（REG-OUTSOURCE-001）

**2.4 明碼儲存**
- ❌ 明碼儲存 API Key、資料庫密碼於 ConfigMap 或環境變數
- ✅ 必須使用 K8s Secret 加密儲存

**違反處理**: 立即移除違反項目,記錄稽核日誌並通知資安處。

### 第 3 條：架構約束

**3.1 部署架構**
- ✅ 內網部署（K8s 內網,無對外公開 API）
- ✅ 四區網路隔離（參考 30_network_arch.md）
- ❌ 禁止部署至公有雲或 DMZ

**3.2 環境隔離**
- ✅ 訓練環境與推論環境分離（不同 K8s namespace）
  - `ml-train`: 訓練環境
  - `ml-api-prod`: 生產 API 環境
  - `ml-api-sit`: 測試 API 環境
- ✅ SIT/UAT 資料必須去識別化,禁止使用生產資料

**3.3 模型分群**
- ✅ 三模型分群（製造業、非製造業、OBU）
- ✅ 各客群獨立模型與門檻設定
  - 製造業: `manufacturing_v*.*.* `
  - 非製造業: `non_manufacturing_v*.*.*`
  - OBU: `obu_v*.*.*`

**3.4 降級機制**
- ✅ 模型服務故障時,必須保留人工覆審降級模式
- ✅ 降級不影響核心業務流程（iCredit 覆審功能）

**違反處理**: 架構違反本條,系統無法通過上線審查。

---

## 第二章：流程約束（強制審核點）

### 第 4 條：模型重訓審核

**4.1 重訓觸發條件**
- PSI（Population Stability Index）> 0.25（模型漂移嚴重）
- Precision 或 Recall 下降 > 20%（相對基線）
- 模型建議被修改率 > 60% 持續 2 週
- 業務需求變更（新增財務指標、調整閾值）
- 定期重訓（每季或每半年）

**4.2 驗證閘門（必須通過,否則阻擋發布）**
- Precision ≥ 50%
- Recall ≥ 70%
- PSI < 0.25
- F1-Score > 0.6（建議）

**4.3 重訓審批**
- 訓練計畫需記錄 GitLab Issue（含重訓原因、資料範圍、參數變更）
- 驗證報告需數科處審核
- 未通過閘門需記錄並通知相關單位

**違反處理**: 未經驗證的模型禁止發布,強制回退。

### 第 5 條：模型發布審核

**5.1 發布前置條件**
- ✅ 通過 SIT/UAT 測試
- ✅ 驗證指標符合閘門要求
- ✅ 變更單（CR）記錄完整
- ✅ 審批記錄（法遵/資安/業務主管）

**5.2 發布權限**
- 僅 R-ADMIN-01（系統管理者）可執行發布
- 必須通過 MFA（多因子驗證）
- 發布時間建議：非營業時間或週末

**5.3 發布後驗證**
- 健康檢查（/health API）
- 煙霧測試（10 筆測試案例）
- 監控指標確認（錯誤率、延遲、可用性）

**5.4 回退機制**
- 保留前 3 個模型版本
- 回退時間 < 1 分鐘（K8s rolling update）
- 回退需記錄原因與稽核日誌

**違反處理**: 未經審批發布視為嚴重違規,立即回退並調查。

### 第 6 條：上線前審核

**6.1 法遵檢核（必須通過,REF: 60_law.md）**
- ✅ CP-AI-001: AI 決策可解釋性驗證（100% 案例有 Top-N 指標）
- ✅ CP-AI-002: 模型版本可追溯性驗證
- ✅ CP-PDPA-001: 個資去識別化驗證（SIT/UAT）
- ✅ CP-PDPA-002: 日誌個資遮罩驗證（Prod）

**6.2 資安檢核（必須通過,REF: 70_infosec.md）**
- ✅ CP-SEC-001: API 認證機制驗證（401/403 正確）
- ✅ CP-SEC-002: 傳輸加密驗證（TLS 1.2+,評級 A）
- ✅ CP-SEC-004: 弱點掃描與滲透測試（HIGH/CRITICAL 漏洞已修復）

**6.3 稽核列席**
- 稽核處列席上線審查會議
- 確認日誌記錄機制與保留策略

**違反處理**: 任一檢核項未通過,禁止上線。

### 第 7 條：年度審核

**7.1 資安評估（每年,REF: REG-SEC-002）**
- 弱點掃描（Nessus/OpenVAS）
- 滲透測試（委外或內部資安團隊）
- SBOM 掃描與 CVE 修補

**7.2 法遵控制點有效性評估（每年,REF: 60_law.md）**
- 法遵控制點（CP-AI-*/PDPA-*/SEC-*）重新驗證
- 法規變更影響評估
- 合規風險評估與更新

**7.3 模型效能審查（每年）**
- 模型漂移趨勢分析（PSI 歷史）
- 預警命中率趨勢（Precision/Recall 歷史）
- 業務價值評估（覆審時間縮短%、使用者滿意度）

**違反處理**: 年度審核缺失需在 90 天內修復,否則暫停服務。

---

## 第三章：合規約束（不可妥協）

### 第 8 條：AI 可解釋性（REG-AI-001/002）

**8.1 強制要求**
- 100% 預警案例必須回傳 Top-N 指標解釋（建議 N ≥ 3）
- 指標解釋包含：指標名稱、異常值、閾值、貢獻度、排序
- 回傳資料必須標註模型版本與特徵版本

**8.2 實施方式**
- API 回應包含 `top_indicators` 陣列
- 每個指標包含 `indicator_name`, `indicator_code`, `indicator_value`, `abnormal_score`, `rank`, `explanation`

**8.3 驗證方式**
- 隨機抽查 20 筆預警案例（CP-AI-001）
- 通過標準：100% 有 Top-N 指標,解釋內容完整可讀

**違反後果**: 視為違反金融業 AI 核心原則,系統下線。

### 第 9 條：個資保護（REG-PDPA-001）

**9.1 SIT/UAT 環境（100% 去識別化）**
- CustomerID → `CUST_001`, `CUST_002`（序號化假名）
- SPID → 保留前 4 碼,例如 `12345678` → `1234****`
- 公司名稱 → `測試公司 A`, `測試公司 B`（假名）
- 授信金額 → 隨機化（數量級相近）

**9.2 Prod 環境（日誌 100% 遮罩）**
- CustomerID → `CUST****`（僅顯示前 4 碼）
- SPID → `1234****`（僅顯示前 4 碼）
- 公司名稱 → `[遮罩]`（完全遮罩）
- 授信金額 → `[數值已移除]`（不記錄）

**9.3 驗證方式**
- SIT/UAT 隨機抽查 50 筆資料（CP-PDPA-001）
- Prod 日誌隨機檢查 100 筆（CP-PDPA-002）
- 通過標準：100% 個資已遮罩,無真實個資外洩

**違反後果**: 個資外洩視為嚴重違規,系統下線並通報法遵處。

### 第 10 條：日誌保留與 RPO（REG-SEC-001, REG-AI-002）

**10.1 日誌保留期限（7 年）**
- 模型推論日誌（輸入輸出、模型版本、Top-N 指標）
- API 呼叫日誌（認證、時間戳、錯誤碼、遮罩個資）
- 操作稽核日誌（模型發布、配置變更、權限變更）
- 認證日誌（登入成功/失敗、MFA 驗證、API Key 使用）
- 資料存取日誌（訓練資料存取、敏感資料查詢）

**10.2 RPO = 0（日誌不可遺失）**
- 日誌寫入失敗 → 本地暫存（K8s PV）→ 每分鐘重試
- 日誌備份：每日增量 + 每月完整備份
- 災難復原：RTO 2 小時（稽核日誌查詢功能）

**10.3 日誌查詢權限**
- R-SEC-01（資安人員）: 檢視所有日誌（敏感欄位遮罩）
- R-AUDIT-01（稽核人員）: 檢視所有日誌（敏感欄位遮罩）
- R-OPS-01（系統管理員）: 檢視技術日誌
- 其他角色：依 RBAC 限制

**違反後果**: 日誌遺失或保留不足視為合規缺失,系統暫停使用。

### 第 11 條：模型版本可追溯性（REG-AI-002）

**11.1 版本管理**
- 所有模型版本必須儲存於 Git（Git LFS）與模型 Registry（MLflow）
- 版本命名規範：`{model_type}_v{major}.{minor}.{patch}`
  - 範例：`manufacturing_v2.3.0`
- Git tag 與模型版本必須一致

**11.2 推論時記錄**
- 每次推論記錄：模型版本、特徵版本、輸入（遮罩）、輸出、時間戳
- 日誌保留 7 年（REF: 第 10 條）

**11.3 回溯能力**
- 任意時間點的預警結果可追溯當時使用的模型版本
- 驗證方式：隨機選擇歷史預警案例,查詢模型版本（CP-AI-002）

**違反後果**: 無法追溯視為違反 AI 治理要求,立即修復。

---

## 第四章：特權操作約束

### 第 12 條：MFA 強制要求

**12.1 必須 MFA 的操作（R-ADMIN-01）**
- 模型發布與版本切換
- 模型回退至舊版本
- 配置變更（閾值、限流、認證設定）
- 權限授予與撤銷
- Secret 管理（API Key、密碼輪替）

**12.2 MFA 實施方式**
- OTP（One-Time Password）: Google Authenticator / Microsoft Authenticator
- 或簡訊 OTP（備援）
- MFA Token 有效期: 30 秒
- 無豁免條件

**12.3 操作記錄**
- 所有特權操作記錄稽核日誌
- 包含：操作人員、MFA 驗證狀態、操作時間、變更前後值、審批單號

**違反後果**: 未經 MFA 的特權操作視為未授權操作,立即撤銷並調查。

### 第 13 條：最小權限原則

**13.1 RBAC 強制執行**
- 7 個角色：R-USER-01, R-SUPER-01, R-DEV-01, R-OPS-01, R-SEC-01, R-AUDIT-01, R-ADMIN-01
- 權限矩陣（REF: 70_infosec.md）
- 欄位層級權限（Column-Level Security）

**13.2 權限申請與審批**
- 申請人填寫權限申請單 → 部門主管審批 → 資安處審查 → 資訊處授予
- 特權權限（R-ADMIN-01）需額外資安處審批

**13.3 權限盤點**
- 每月自動產出權限清單,部門主管確認
- 每季資安處抽查權限使用記錄
- 離職/調職 24 小時內撤銷所有權限

**違反後果**: 權限濫用視為安全事件,撤銷權限並記錄。

---

## 第五章：監控與告警約束

### 第 14 條：強制監控指標

**14.1 必須監控（12 項關鍵指標,REF: 80_nfr.md）**
- NFR-MON-001: 模型推論錯誤率 > 5% → 15 分鐘內回應
- NFR-MON-004: 系統可用性 < 99.5% → 立即告警
- NFR-MON-005: 模型命中率下降 > 10% → 24 小時內檢視
- NFR-MON-007: 稽核日誌寫入失敗 > 5 次 → 立即告警
- NFR-MON-011: 模型漂移（PSI > 0.2）→ 48 小時內檢視

**14.2 告警通知**
- P0-Critical: Email + 訊息（Microsoft Teams） + 電話（持續未回應）
- P1-High: Email + 訊息
- P2-Medium: Email

**14.3 告警回應時效**
- P0-Critical: 立即回應
- P1-High: 15-30 分鐘內回應
- P2-Medium: 1-4 小時內回應

**違反後果**: 監控缺失導致重大事件視為維運缺失,檢討流程。

### 第 15 條：異常偵測與自動化**

**15.1 自動化異常偵測規則**
1. 短時間多次失敗登入 → 帳號鎖定 15 分鐘
2. 異常大量資料下載 → 告警並記錄
3. 非常態時間存取 → 記錄並通知
4. 未授權 API 嘗試 → 告警
5. 模型版本異常 → 立即告警

**15.2 CSIRT 召集條件（P0/P1）**
- 組成：R-SEC-01（組長）、R-OPS-01、R-ADMIN-01、法遵處代表
- 職責：事件調查、影響評估、修復協調、報告撰寫

**違反後果**: 異常事件未處理視為安全風險,升級至督導層。

---

## 第六章：資料與模型保護

### 第 16 條：環境隔離

**16.1 強制隔離**
- 訓練環境（`ml-train`）與推論環境（`ml-api-prod`）完全隔離
- 訓練資料不可複製到推論環境
- 測試環境（`ml-api-sit`）資料必須去識別化

**16.2 K8s NetworkPolicy**
- 訓練 Pod 不可連線推論 API
- 推論 API 不可連線訓練環境
- Egress 僅允許必要連線（DB, Registry）

**16.3 訓練資料存取**
- 存取需審批（GitLab Issue 記錄）
- 每次存取記錄稽核日誌
- 僅數科處/模型工程師可存取

**違反後果**: 環境隔離破壞視為重大安全風險,立即修復。

### 第 17 條：傳輸與儲存加密

**17.1 傳輸加密（強制 TLS 1.2+）**
- iCredit → API Gateway: HTTPS TLS 1.2+
- API Pod → PostgreSQL/TEJ DB: TLS 1.2+
- GitLab → K8s Registry: HTTPS TLS 1.2+

**17.2 儲存加密（AES-256）**
- 財報資料: PostgreSQL TDE
- 模型 artifact: K8s PV / S3 加密
- 日誌: ELK/Splunk 加密儲存
- Secret: K8s Secret etcd 加密

**17.3 金鑰管理**
- 金鑰儲存: K8s Secret 或外部 KMS
- 金鑰輪替: 每年,舊金鑰保留 30 天
- 存取控制: 僅 R-ADMIN-01

**違反後果**: 加密缺失視為安全缺陷,禁止上線。

---

## 第七章：文件與溝通

### 第 18 條：強制文件交付

**18.1 上線前必交文件**
- API 規格文件（含認證/加密/錯誤碼）
- 操作手冊（含個資保護/法遵要求）
- 維運手冊（含日誌/監控/告警）
- 模型驗證報告（Precision/Recall/PSI）
- 資安評估報告（弱掃/滲透測試）

**18.2 文件更新要求**
- 重大變更後 7 天內更新文件
- 文件版本管理（Git）
- 文件審查（法遵/資安/稽核）

**違反後果**: 文件缺失或過時視為維運缺失,影響上線審查。

### 第 19 條：溝通與會議

**19.1 定期會議**
- 雙週例會（全核心單位）
- 技術設計審查（里程碑）
- SIT/UAT 會議（測試前/後）
- 里程碑匯報（Q3/Q4）

**19.2 報告機制**
- 週報（核心團隊）
- 月報（督導/指導層）
- 里程碑報告（Q3/Q4）

**違反後果**: 溝通不足導致問題延遲發現視為專案管理缺失。

---

## 第八章：變更管理

### 第 20 條：變更流程

**20.1 變更提案**
- 由需求方或技術方提出
- 包含範圍/時程/成本/風險影響
- 記錄 GitLab/JIRA

**20.2 影響評估**
- 專案經理 + 技術負責人共同評估
- 法遵/資安影響評估（若涉及）

**20.3 審查決策**
- 督導/指導層審查後核定
- 高風險變更需法遵/資安簽核

**20.4 執行與回報**
- 落地變更並更新文件
- 通知利害關係人
- 測試/驗收後關閉

**違反後果**: 未經審批的變更視為違規,立即回退。

### 第 21 條:憲法變更

**21.1 憲法修訂條件**
- 法規變更須強制修訂
- 重大技術架構變更須評估修訂
- 業務目標變更須評估修訂

**21.2 修訂流程**
- 提案 → 影響評估 → 專案督導主管審批 → 發布新版本
- 版本管理（Git tag）
- 通知所有相關單位

**21.3 生效時間**
- 新版憲法自發布日起 7 天後生效
- 緊急修訂可即時生效（須督導主管核准）

**違反後果**: 未經核准的憲法變更無效。

---

## 附錄 A：核心原則總結

**技術約束（3 項）**:
1. Python 3.12 + XGBoost + FastAPI + K8s
2. TLS 1.2+ / AES-256 / K8s Secret
3. 內網部署 + 環境隔離 + 三模型分群

**流程約束（4 項）**:
1. 模型重訓驗證閘門（Precision ≥ 50%, Recall ≥ 70%, PSI < 0.25）
2. 模型發布審核（CR + MFA + 測試通過）
3. 上線前檢核（7 個法遵/資安控制點）
4. 年度審核（弱掃/滲透/法遵/模型效能）

**合規約束（4 項）**:
1. AI 可解釋性（100% Top-N 指標解釋）
2. 個資保護（SIT/UAT 100% 去識別,Prod 100% 遮罩）
3. 日誌 7 年保留 + RPO = 0
4. 模型版本可追溯性（Git + Registry + 推論日誌）

**總計**: 11 項不可妥協的核心約束

---

## 附錄 B：關鍵參考文件

| 文件 | 路徑 | 關鍵內容 |
|------|------|---------|
| 專案總結 | [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md) | 專案概覽、風險控制、技術約束摘要 |
| 專案基本資料 | [00_meta.md](project/meta/00_meta.md) | 利害關係人、時程、預算 |
| 業務目標 | [10_business.md](project/business/10_business.md) | KPI、使用者故事、業務風險 |
| 法規遵循 | [60_law.md](project/law/60_law.md) | 9 項法規、12 個控制點、15 類留存文件 |
| 資訊安全 | [70_infosec.md](project/infosec/70_infosec.md) | RBAC、資料分級、加密、K8s 安全 |
| 非功能需求 | [80_nfr.md](project/nfr/80_nfr.md) | 41 個 NFR、SLA/RTO/RPO、監控指標 |
| 稽核可稽性 | [90_audit.md](project/audit/90_audit.md) | 21 個稽核事件、9 個報表、7 年保留 |

---

## 簽核記錄

| 角色 | 姓名 | 簽名 | 日期 |
|------|------|------|------|
| 專案督導主管 | [TBD] | [待簽核] | [待簽核] |
| 法遵部門主管 | [TBD] | [待簽核] | [待簽核] |
| 資安部門主管 | [TBD] | [待簽核] | [待簽核] |
| IT 部門主管 | [TBD] | [待簽核] | [待簽核] |
| 專案經理 | [TBD] | [待簽核] | [待簽核] |

---

*本憲法自核准日起生效,所有專案成員必須遵守。*

**版本歷史**:
- v1.0.0 (2025-11-21): 初版發布,基於 PROJECT_SUMMARY.md 提煉
